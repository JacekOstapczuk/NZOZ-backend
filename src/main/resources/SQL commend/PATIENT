CREATE TABLE PATIENT_AUD
(
    EVENT_ID   INT(11)  NOT NULL AUTO_INCREMENT,
    EVENT_DATE DATETIME NOT NULL,
    EVENT_TYPE VARCHAR(10) DEFAULT NULL,
    OLD_PATIENT_ID INT(11),
    NEW_PATIENT_ID INT(11),
    OLD_NAME VARCHAR(20),
    NEW_NAME VARCHAR(20),
    OLD_SURNAME VARCHAR(20),
    NEW_SURNAME VARCHAR(20),
    OLD_PESEL INT(11),
    NEW_PESEL INT(11),

    PRIMARY KEY (EVENT_ID)
);


DELIMITER $$

CREATE TRIGGER PATIENT_INSERT AFTER INSERT ON PATIENTS
    FOR EACH ROW
BEGIN
    INSERT INTO PATIENT_AUD (EVENT_DATE ,EVENT_TYPE,NEW_PATIENT_ID,NEW_NAME, NEW_SURNAME, NEW_PESEL)
        VALUE(CURTIME(), 'INSERT', NEW.ID, NEW.NAME, NEW.SURNAME, NEW.PESEL);
END $$

DELIMITER ;

DELIMITER $$

CREATE TRIGGER PATIENT_DELETE AFTER DELETE ON PATIENTS
    FOR EACH ROW
BEGIN
    INSERT INTO PATIENT_AUD (EVENT_DATE ,EVENT_TYPE,OLD_PATIENT_ID,OLD_NAME, OLD_SURNAME, OLD_PESEL)
        VALUE(CURTIME(), 'DELETE', OLD.ID, OLD.NAME, OLD.SURNAME, OLD.PESEL);
END $$

DELIMITER ;


DELIMITER $$

CREATE TRIGGER PATIENT_UPDATE AFTER UPDATE ON PATIENTS
    FOR EACH ROW
BEGIN
    INSERT INTO PATIENT_AUD (EVENT_DATE ,EVENT_TYPE,NEW_PATIENT_ID,NEW_NAME, NEW_SURNAME, NEW_PESEL,
                             OLD_PATIENT_ID,OLD_NAME, OLD_SURNAME, OLD_PESEL)

        VALUE(CURTIME(), 'UPDATE ', NEW.ID, NEW.NAME, NEW.SURNAME, NEW.PESEL,
              OLD.ID, OLD.NAME, OLD.SURNAME, OLD.PESEL);
END $$

DELIMITER ;